:root{
  --bg:#f7f7fb;
  --panel:#fff;
  --border:#e6e6ef;
  --text:#1f2330;
  --muted:#6b7280;
  --brand:#1e40af;
  --brand-2:#3b82f6;
  --bubble-user:#e9ecff;
  --bubble-bot:#ffffff;
  --shadow:0 6px 20px rgba(0,0,0,.06);
  --radius:14px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}

/* 布局 */
#app{display:grid; grid-template-columns: 300px 1fr; height:100vh;}

/* 左侧栏 */
#sidebar{
  border-right:1px solid var(--border);
  background:#fff; display:flex; flex-direction:column; overflow:hidden;
}
.sidebar-header{display:flex; gap:10px; align-items:center; padding:16px; border-bottom:1px solid var(--border)}
.brand{font-weight:700; color:var(--brand)}
.btn{padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:#fff; cursor:pointer}
.btn-primary{background:var(--brand-2); color:#fff; border-color:var(--brand-2)}
.btn-ghost{background:#fff}

.session-list{overflow:auto; padding:10px 12px; flex:1}
.session{
  position:relative;
  padding:10px; border-radius:12px; border:1px solid var(--border);
  background:#fff; margin-bottom:10px; cursor:pointer
}
.session.active{outline:2px solid var(--brand-2); outline-offset:2px}
.session-title{font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding-right:34px;}
.session-sub{font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-top:4px}

.session .del{
  position:absolute; right:8px; top:8px;
  width:28px; height:28px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  border:1px solid var(--border); background:#fff; color:#888; cursor:pointer;
}
.session .del:hover{ background:#ffecec; color:#c53030; border-color:#ffd0d0 }

.sidebar-footer{padding:12px 16px; color:var(--muted); border-top:1px dashed var(--border)}

/* 右侧主区 */
#main{display:grid; grid-template-rows: auto 1fr auto; height:100vh;}
.chat-header{display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background:#fff; border-bottom:1px solid var(--border)}
.chat-title{font-weight:700}
.chat-sub{color:var(--muted); font-size:13px}

.messages{padding:18px; overflow:auto}
.msg{max-width:820px; margin:12px auto; display:flex}
.bubble{
  padding:12px 14px; border-radius:16px; box-shadow:var(--shadow);
  border:1px solid var(--border); background:var(--bubble-bot);
  white-space:pre-wrap; word-break:break-word;
}
.msg.user{justify-content:flex-end}
.msg.user .bubble{background:var(--bubble-user); border-color:#dbe4ff}
.meta{max-width:820px; margin:4px auto 0; color:var(--muted); font-size:12px}

/* 底部输入 */
#composer{
  position:sticky; bottom:0; left:0; right:0; background:#fff; border-top:1px solid var(--border);
  display:flex; gap:12px; align-items:flex-end; padding:12px 16px;
}
#q{
  flex:1; resize:vertical; min-height:48px; max-height:160px;
  border:1px solid var(--border); border-radius:12px; padding:12px; background:#fff; outline:none;
}
.actions{display:flex; gap:10px}

/* 模态框 */
.modal.hidden{display:none}
.modal{
  position:fixed; inset:0; background:rgba(0,0,0,.35);
  display:flex; align-items:center; justify-content:center; z-index:1000;
}
.modal-card{
  width:420px; max-width:calc(100% - 40px);
  background:#fff; border-radius:var(--radius); box-shadow:var(--shadow);
  padding:18px;
}
.modal-title{font-weight:700; margin-bottom:6px}
.modal-sub{color:var(--muted); margin-bottom:14px}
.modal-actions{display:flex; justify-content:flex-end; gap:10px}
.btn-danger{background:#e11d48; color:#fff; border-color:#e11d48}
.btn-danger:hover{filter:brightness(0.95)}

/* ===== References 样式优化 ===== */
.messages .bubble ul {
  margin: 4px 0;          /* 减小上下间距 */
  padding-left: 10px;     /* 缩进更小 */
  list-style: none;       /* 去掉黑点 */
}

.messages .bubble li {
  margin: 2px 0;          /* 行距更紧凑 */
}

.messages .bubble a {
  color: #1e40af;         /* 柔和蓝色 */
  text-decoration: none;  /* 无下划线 */
  font-weight: 500;
}

.messages .bubble a:hover {
  text-decoration: underline; /* 悬停时才出现下划线 */
  color: #0f172a;
}

.messages .bubble strong {
  display: block;
  margin-bottom: 2px;     /* 标题与列表间稍微留一点空间 */
  font-weight: 600;
}

/* ====== 分区布局：上半消息，下半会话 ====== */
#sidebar {
  display: flex;
  flex-direction: column;
  height: 100%;
  border-right: 1px solid var(--border);
  background: #fff;
}
/* 整体两块：上半消息、下半会话 */
.sidebar-body {
  display: flex;
  flex-direction: column;
    height: 100%;
}

/* 上半区（固定高度或比例） */
.message-box {
  flex: 0 0 25%;
  border-bottom: 1px dashed var(--border);
  padding: 12px 16px;
  overflow-y: auto;
  background: #fff;
}

/* 下半区：独立滚动 */
.session-container {
  flex: 1;

  display: flex;
  flex-direction: column;
  overflow: hidden;             /* 防止整体滑动 */
}

.session-list {
  flex: 1;
  overflow-y: auto;             /* ✅ 单独滚动 */
  padding: 10px 12px;
}

.sidebar-footer {
  padding: 12px 16px;
  color: var(--muted);
  border-top: 1px dashed var(--border);
}

/* ====== 会话列表标题 Chats ====== */
.session-header {
  font-weight: 700;        /* ✅ 加粗字体 */
  font-size: 15px;         /* 稍微大一点 */
  color: var(--text);      /* 主体颜色，区别 muted 灰色 */
  padding: 8px 16px 6px;
  border-bottom: 1px dashed var(--border);
  background: #fff;
  position: sticky;
  top: 0;
  z-index: 2;              /* 滚动时固定 */
}

/* ===== Library 折叠区 ===== */
.lib-toggle{
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border: none;
  font-size: 15px;
  background: #fff;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 700;
}
.lib-toggle:hover{ background:#f8fafc; }
.lib-count{ margin-left: 6px; color: var(--muted); font-weight: 400; }
.lib-toggle .chev{ float: right; transition: transform .2s; }
.lib-toggle .chev.up{ transform: rotate(180deg); }

/* 折叠面板：默认收起；打开时平滑展开且内部可滚动 */
.library-panel{
  max-height: 0;
  overflow: hidden;
  transition: max-height .25s ease, padding .25s ease;
  padding: 0 2px;
}
.library-panel.open{
  max-height: 220px;            /* 展开高度，可按需要调大/调小 */
  padding: 8px 2px;
}

.library-list{
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 200px;            /* 和上面的 max-height 协同 */
  overflow: auto;
}

.lib-item{
  padding: 6px 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  text-decoration: none;
  color: #1e40af;
  font-weight: 500;
}
.lib-item:hover{
  background: #f7fafc;
  text-decoration: none;

}
.lib-empty{ color: var(--muted); padding: 4px 2px; }
